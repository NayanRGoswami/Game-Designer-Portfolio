{"ast":null,"code":"'use strict';\n\nvar Task = require('./UploadTask');\n\nvar fs = require('fs');\n\nvar request = require('request');\n\nvar _ = require('lodash'); // auth = {\n//     type: 'token' or 'oauth2',\n//     token: the access token\n// }\n\n\nvar CONFIG = {\n  BASE_API_URL: 'https://api.sketchfab.com',\n  BASE_SERVER_URL: 'https://sketchfab.com',\n  UPLOAD_ENDPOINT: '/v3/models',\n  POLL_ENDPOINT: '/v3/models/{uid}',\n  ME_ENDPOINT: '/v3/me',\n  MODEL_URL: '/models/{uid}',\n  INTERVAL: 5 //@TODO: add timeout\n\n};\n\nfunction Sketchfab(auth, config) {\n  if (auth === undefined) {\n    throw 'No authentication method provided.';\n  } else {\n    this._auth = auth;\n  }\n\n  this._config = _.defaults(config || {}, CONFIG);\n}\n\nSketchfab.prototype.upload = function (options, callback) {\n  if (options.file) {\n    fs.stat(options.file, function onFileCheck(err, stats) {\n      if (stats.isFile()) {\n        var task = new Task(this._auth, this._config, options, stats);\n        callback(null, task);\n      } else {\n        callback('File not found ' + options.file, null);\n      }\n    }.bind(this));\n  } else {\n    callback('No file specified', null);\n  }\n};\n\nSketchfab.prototype._get = function (endpoint, callback) {\n  var req;\n\n  if (this._auth.type === 'token') {\n    req = request({\n      method: 'GET',\n      uri: this._config['BASE_API_URL'] + endpoint,\n      qs: {\n        token: this._auth.token\n      }\n    }, callback);\n  } else if (this._auth.type === 'oauth2') {\n    req = request({\n      method: 'GET',\n      uri: this._config['BASE_API_URL'] + endpoint,\n      headers: {\n        Authorization: 'Bearer ' + this._auth.token\n      }\n    }, callback);\n  }\n};\n\nSketchfab.prototype.me = function (callback) {\n  this._get(CONFIG.ME_ENDPOINT, function (err, response, body) {\n    var parsedBody;\n\n    try {\n      parsedBody = JSON.parse(body);\n    } catch (e) {\n      callback('Response parsing error', {});\n      return;\n    }\n\n    if (response.statusCode === 200) {\n      callback(null, parsedBody);\n    } else {\n      callback(parsedBody, {});\n    }\n  });\n};\n\nmodule.exports = Sketchfab;","map":null,"metadata":{},"sourceType":"script"}